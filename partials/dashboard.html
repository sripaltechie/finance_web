<!-- <button style="width: 150px;" class="btn btn-primary form-control noprint" data-toggle="modal" data-target="#pmtransmodal">Add Amount in Chiti</button> -->
<div class="container" ng-init="init()">
    <form name="rcvdcolForm">
        <div class="container" style="padding-top:100px; "  >
            <div class="form-inline">
                <div class="row">
                    <div class="col-md-3">
                            <div class="form-group">
                                <div class="input-group date" >
                                <input type="text" style="width:150px;" class="form-control" ng-change="setDate()"  placeholder="Date" ng-model="rcvd.rcvddate" name="dAte" id="dAte" autocomplete="off" >
                                <span  class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
                                </div>
                            <br>
                            <br>
                        
                                <input type="button" class="btn btn-primary" ng-click="todaydate()" value="today">
                                <input type="button" class="btn btn-primary" ng-click="yesterdaydate()" value="1">
                                <input type="button" class="btn btn-primary" ng-click="DByesterdaydate()" value="2">
                                <input type="button" class="btn btn-primary" ng-click="D2Byesterdaydate()" value="3">
                        </div>   
                    </div>  
                    <div class="col-md-2">
                        <div class="form-group">
                            <!-- <select ng-change="getcolllistgrp()"  ng-model="Hami" class="form-control" ng-options="h.id as h.Firstname + '  ' + h.LastName  for h in hami" name="haminame" id="haminame"  >
                                <option selected value="">Select Hami</option>
                            </select> -->
                            <label class="col-md-4 col-xs-4 col-sm-4">Hami</label>
                            <input autocomplete="off" type="text" ng-keydown="getid($event,'hami')" name="haminame" id="haminame" ng-model="rcvd.haminame" class="form-control" typeahead="h.Firstname + '_' + h.LastName + '(' + h.HamiFirstName + ')' for h in hami | filter:{Firstname:$viewValue}" required focus> 
                        </div> 
                    </div>
                    <div class="col-md-2">
                            <div class="form-group">
                        <!-- <select ng-change="getcollectionList()"  ng-model="chitifilter" class="form-control" ng-options="cl.chiti as cl.customerFL+ '(' + cl.code + ')' + '- ' + cl.chiti  for cl in collectiongrp" name="chiti" id="chiti"  >
                            <option selected value="">Select Chiti </option>
                        </select> -->
                        <label class=" text-right" >Chiti</label>
                        <input autocomplete="off" type="text" name="chiti" id="chiti" ng-keydown="getid($event,'chiti')" ng-model="rcvd.chitiname" class="form-control" typeahead="cl.customerFL+ '(' + cl.code + ')' + '- ' + cl.chiti for cl in collectiongrp | filter:{customerFL:$viewValue}" required focus> 
                        </div> 
                    </div>      
                    <div class="col-md-3">
                        <!-- <div class="form-group">
                            <select ng-change="getreceivedamount()"  ng-model="receivedfrom" class="form-control" ng-options="h.id as h.Firstname + '  ' + h.LastName +'('+h.HamiFirstName+')' for h in customers" name="rcvdfrom" id="rcvdfrom"  >
                                <option selected value="">Received From </option>
                            </select>
                        </div>  -->
                        <div class="form-group" style="margin-left:50px ;">
                            <label class=" text-right" >Customer</label>
                            <div >
                                <input autocomplete="none" autocomplete="off" type="text" name="customername" id="customername" ng-keydown="getid($event,'customer')" ng-model="rcvd.customername" class="form-control" typeahead="customer.Firstname + '_' + customer.LastName + '(' + customer.HamiFirstName + ')' for customer in customers | filter:{Firstname:$viewValue}" required focus> 
                                <span class="error" ng-show="(rcvdcolForm.customername.$dirty || submitted) && rcvdcolForm.customername.$error.required" >
                                    Customer Name Required!
                                </span>
                            </div>
                        </div> 
                    </div> 
                    
                    <div class="col-md-2">
                        <div class="form-group">
                            <label >Amount</label>
                            <input type="number" ng-change="markrcvd()" ng-model= "rcvd.amount" class="form-control" style="width: 150px;">
                            <!-- {{extradisp}} -->
                        </div>
                        
                    </div>    
                    
                    <!-- <div class="col-md-8" style="margin-top: 10px;border: 1px solid;padding: 20px;padding-left: 100px;" ng-show="rcvd.paymentmode == 50"  style="margin-top: 10px;">
                        <form name="multipmform" >
                            <div class="row" ng-repeat="multi in rcvd.pmtrans">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Payment mode: </label>
                                        <select ng-change="pmtotal()" name="paymentmode{{$index}}" id="paymentmode{{$index}}" class= "form-control" ng-options="pm.id as pm.modename for pm in paymentmodelist"  ng-model="multi.paymentmode" focus> 
                                            <option selected>Select</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="form-group">
                                        <label class="col-md-5 col-xs-5 col-sm-5 text-right" >Amount</label>
                                        <div class="col-md-7 col-xs-7 col-sm-7">
                                            <input ng-change="pmtotal()" autocomplete="none" style="width: 100px;" autocomplete="off" type="text" name="amount" id="amount" ng-model="multi.amount" class="form-control" focus> 
                                        </div>
                                    </div>                   
                                </div>    
                            </div>                            
                        </form>
                        <button type="button" class="btn btn-primary" ng-click="addpmmode()">Add</button>
                        <button type="button" class="btn btn-primary" ng-click="rcvd.paymentmode = 1;checkmultipm()">Single</button>
                    </div>         -->
                </div>

                <div class="row" style="padding-top: 50px;">
<!--                     
                    <div class="col-md-3" ng-show="false">
                        <div class="form-group">
                                <label>Extra's : </label>
                        <input  type="number"  ng-model= "bfreextra" >
                        
                        </div>
                    </div> -->
                    <!-- <div class="col-md-3">
                        <div class="form-group">
                            <label>Paymednt mode</label>
                            <select ng-change="getchitiid();checkmultipm()" ng-model="rcvd.paymentmode" class="form-control" ng-options="pm.id as pm.modename for pm in paymentmodelist" name="paymentmode" id="paymentmode"  >
                                <option selected value="">Paymentmode </option>
                            </select>
                        </div>
                        
                    </div> -->
                    <div class="col-md-1"  >
                        <button class="btn btn-primary"  ng-click="checkSubmit()" >Submit</button>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-primary" ng-click="steps= 0.5" >Daily </button>
                    </div>
                    <div class="col-md-3" style="padding-top: 20px;">
                        <label>Note : </label>
                        <textarea ng-model="rcvd.note" style="width: 500px;height: 100px;" ></textarea>
                    
                    </div>
                    <div class="col-md-3" style="padding-top: 20px;">
                        <label>Chiti Notes : </label>
                        <textarea ng-model="rcvd.note1" style="width: 300px;height: 100px;" ></textarea>
                        
                    </div>
                </div>
    <br>
    <br>
                <table  style="padding-top: 50px;" class="table condensed-table">
                        <tr>
                        <td>ID</td>
                        <td>Chiti ID</td>
                        <td>Customer</td>
                        <td>Date</td>
                        <td>Amount</td>
                        <td>Received</td>
                        <td>Received Amt</td>
                        </tr>
                </thead>
                <tbody>
                    <tr  ng-repeat="c in collection" >
                        <td><a ng-href="">{{c.id}}</a></td>
                        <td>{{c.chiti}} </td>
                        <td><a ng-href="#/chiti/{{c.chiti}} " target="_blank" >{{c.customerFL}}</a></td>
                        <td>{{changeDateUserFormat(c.date)}}</td>
                        <td>{{c.amount}}</td>
                        <td><input type="checkbox" style="width: 40px;height: 40px;" ng-change="markrcvd($index)"  ng-model="c.received" > </td>
                        <td><input type="text" style="width: 100px;" ng-change="getttlamount()"  name="rcvdamt{{$index}}" style="width: 500px;" id="rcvdamt{{$index}}"  ng-show="c.received" ng-model="c.rcvdamt" > </td>
                    </tr>
                
                </tbody>
                </table> 
     

                <center><button class="btn btn-primary" ng-click="checkSubmit()" >Submit</button></center>
     <!--<button class=" btn btn-primary" ><a href="#" style="color: white;" id="save-link">Download</a> </button>-->
    
            </div>
        </div>
    </form>
</div>


<div id="pmtransmodal"class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-md" >
        <!-- Modal content -->
        <div class="modal-content">
           <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <center>
                 <h4>Adjust Payment with Paymentmode </h4>
              </center>
           </div>
           <div class="modal-body"  style="max-width: fit-content!important;">
              <form ng-submit="addcollection()" name="pmtransform" >
                 <div class="container">
                     <div class="row">
                        <div class="col-md-2">
                            <select ng-change="selectall()" ng-model="commonpmmode" name="selectall" id="selectall" class= "form-control" ng-options="pm.id as pm.modename for pm in paymentmodelist" focus> 
                                <option selected>Select</option>
                            </select>
                        </div>
                     </div>
                    <div class="form-inline" ng-repeat="cl in rcvd.collectionarr" >
                       <div class="row " style="padding-top: 28px;padding-left: 28px;" >
                            <div class="col-md-2">
                               <div class="form-group">
                                  <label> Colid : </label>{{cl.colid}}
                                  <!-- <input type="number" name="intamt" ng-model="asaluamount" class="form-control"> -->
                               </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                   <label> Colamt : </label>{{cl.colamt}}
                                   <!-- <textarea type="text" name="intnote" ng-model="asalunote" class="form-control">
                                   </textarea> -->
                                </div>
                             </div>
                             <div class="col-md-2" ng-show="cl.paymentmode != 50" >
                                <div class="form-group" >
                                    <select ng-change="checkmultipm($index)" ng-init="cl.paymentmode=1"  name="paymentmode{{$index}}" id="paymentmode{{$index}}" class= "form-control" ng-options="pm.id as pm.modename for pm in paymentmodelist"  ng-model="cl.paymentmode" focus required> 
                                        <option selected>Select</option>
                                    </select>
                                    <div role="alert">
                                        <span class="error" ng-show="(pmtransform.paymentmode{{$index}}.$dirty || submitted) && pmtransform.paymentmode{{$index}}.$error.required ">
                                            Required!
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>     
                        <div class="row">
                            <div class="col-md-4" ng-show="cl.paymentmode == 50">
                                <div class="form-group" ng-repeat="pm in cl.pmtrans">
                                    <select name="pmtrans{{$index}}" id="pmtrans{{$index}}" class= "form-control" ng-options="pm.id as pm.modename for pm in paymentmodelist | filter: filterpmtrans()"  ng-model="pm.paymentmode" focus ng-required="cl.paymentmode == 50"> 
                                        <option selected>Select</option>
                                    </select>
                                    <input type="text" name="credit{{$index}}" id="credit{{$index}}" class="form-control" style="width: 55%;" ng-model="pm.credit" ng-required="cl.paymentmode == 50">
                                    
                                </div>
                                <button type="button" class="btn btn-primary" ng-click="addpmmode($index)">Add</button>
                                <button type="button" class="btn btn-primary" ng-click="cl.paymentmode = 1;checkmultipm($index)">Single</button>
                            </div>
                            <div class="col-md-8"></div>
                        </div>
                         <!-- row -->
                         <!-- <div class="row " style="padding-top: 28px;padding-left: 28px;" >
                               <div class="col-md-5 text-center">
                                  <div class="form-group">
                                     <label> Colamt : </label>{{cl.colamt}}
                                  </div>
                               </div>
                           </div>        -->
                            <!-- row -->
                        </div>
                        <div class="row text-center" style="padding-top: 20px;"  >
                            <div class="col-md-6" style="color: red;">
                                {{errormsg}}
                            </div>
                        </div>
                        <div class="row text-center" style="padding-top: 20px;"  >
                           <div class="col-md-6">
                              <input type="submit" class="btn btn-success"  >
                           </div>
                        </div>
                    <!-- form-inline -->
                 </div>
                 <!-- container -->
              </form>
           </div>
        </div>
     </div>
  </div>

 
 <script>
 
 $('#save-link').click(function ()
{
   
 /* var retContent = [];
  var retString = '';
  $('tbody tr').each(function (idx, elem)
  {
    var elemText = [];
    $(elem).children('td').each(function (childIdx, childElem)
    {
      elemText.push($(childElem).text());
      
    });
    retContent.push(`(${elemText.join(',')})`);
  });
  retString = retContent.join(',\r\n');*/
  function getScope(ctrlName) {
    var sel = 'div[ng-controller="' + ctrlName + '"]';
    return angular.element(sel).scope();
}
var $scope = getScope('dashboard1Ctrl');

    // var newvalue = $scope.customers;
     console.log(newvalue);
  retString =newvalue;
	var file = new Blob([retString], {type: 'text/plain'});
  var btn = $('#save-link');
  btn.attr("href", URL.createObjectURL(file));
  btn.prop("download", "data.txt");
})

</script>